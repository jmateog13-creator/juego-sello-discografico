<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joc del Segell Discogràfic</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .game-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .budget-display {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            color: white;
        }

        .budget-display h2 {
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .phase {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
        }

        .phase.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .phase h2 {
            color: #764ba2;
            margin-bottom: 20px;
            font-size: 1.6em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .option-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-card {
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .option-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .option-card.selected {
            border-color: #764ba2;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
        }

        .option-card h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .option-card .cost {
            font-weight: bold;
            font-size: 1.1em;
            color: #e74c3c;
        }

        .option-card.selected .cost {
            color: #fff;
        }

        .option-card .streams {
            color: #27ae60;
            font-weight: bold;
            margin-top: 5px;
        }

        .option-card.selected .streams {
            color: #fff;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .artist-info {
            background: rgba(103, 126, 234, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .summary {
            background: rgba(39, 174, 96, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .summary h3 {
            color: #27ae60;
            margin-bottom: 15px;
        }

        .card-event {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .final-results {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 35px;
            text-align: center;
            margin-top: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .final-results h2 {
            font-size: 2.2em;
            margin-bottom: 25px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            color: white;
        }

        .final-results h3 {
            font-size: 1.4em;
            margin: 15px 0;
            padding: 10px 0;
        }

        .final-results .profit-display {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .final-results .profit-display h2 {
            font-size: 2.5em;
            margin: 10px 0;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            color: white;
            font-family: 'Impact', 'Arial Black', sans-serif;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .final-results .profit-amount {
            font-size: 3.8em;
            font-weight: 900;
            margin: 15px 0;
            font-family: 'Impact', 'Arial Black', sans-serif;
            letter-spacing: 3px;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.5);
        }

        .final-results .profit-positive {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .final-results .profit-negative {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .dice-container {
            text-align: center;
            margin: 20px 0;
        }

        .dice {
            font-size: 3em;
            margin: 10px;
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            display: inline-block;
            min-width: 80px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .marketing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .checkbox-option input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-header">
            <h1>🎵 Joc del Segell Discogràfic 🎵</h1>
            <p>Gestiona el teu segell i llança el proper gran hit!</p>
        </div>

        <div class="budget-display">
            <h2>💰 Pressupost: <span id="budget">50000</span>€</h2>
            <p>Despeses totals: <span id="totalSpent">0</span>€ | Restant: <span id="remaining">50000</span>€</p>
            <div style="margin-top: 10px;">
                <span style="background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 15px;">
                    🎮 Partida: <span id="gameNumber">1</span>
                </span>
                <button class="btn" onclick="showHistory()" style="margin-left: 10px; padding: 8px 20px; font-size: 0.9em;" id="historyBtn" disabled>
                    📊 Veure Historial
                </button>
            </div>
        </div>

        <!-- Fase 1: Creació del Concepte -->
        <div class="phase active" id="phase1">
            <h2>🎯 Fase 1: Creació del Concepte del Single</h2>
            <div class="artist-info">
                <h3>Informació de l'Artista:</h3>
                <input type="text" id="artistName" placeholder="Nom de l'artista fictici" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ddd;">
                <input type="text" id="songTitle" placeholder="Títol de la cançó" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ddd;">
                <textarea id="songMood" placeholder="Descriu el mood/emoció de la cançó" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ddd; height: 80px;"></textarea>
            </div>
            <button class="btn" onclick="nextPhase()">Continuar a la Producció Musical 🎵</button>
        </div>

        <!-- Fase 2: Producció Musical -->
        <div class="phase" id="phase2">
            <h2>🎵 Fase 2: Producció Musical</h2>
            <p>Tria el nivell de producció per a la teva cançó:</p>
            <div class="option-grid">
                <div class="option-card" onclick="selectOption('production', 'normal', 5000, 20000)">
                    <h3>Producció NORMAL</h3>
                    <p>So correcte, pocs instruments.</p>
                    <div class="cost">Cost: 5.000€</div>
                    <div class="streams">+20.000 streams potencials</div>
                </div>
                <div class="option-card" onclick="selectOption('production', 'good', 10000, 50000)">
                    <h3>Producció BONA</h3>
                    <p>So professional, més capes de so.</p>
                    <div class="cost">Cost: 10.000€</div>
                    <div class="streams">+50.000 streams potencials</div>
                </div>
                <div class="option-card" onclick="selectOption('production', 'spectacular', 15000, 100000)">
                    <h3>Producció ESPECTACULAR</h3>
                    <p>So increïble, amb arranjaments complexos i efectes.</p>
                    <div class="cost">Cost: 15.000€</div>
                    <div class="streams">+100.000 streams potencials</div>
                </div>
            </div>
            <button class="btn" onclick="previousPhase()" style="background: #95a5a6;">⬅️ Enrere</button>
            <button class="btn" id="nextBtn2" onclick="nextPhase()" disabled>Continuar al Videoclip 🎬</button>
        </div>

        <!-- Fase 3: Videoclip -->
        <div class="phase" id="phase3">
            <h2>🎬 Fase 3: Direcció d'Art i Videoclip</h2>
            <p>Tria el tipus de videoclip:</p>
            <div class="option-grid">
                <div class="option-card" onclick="selectOption('video', 'lyric', 5000, 10000)">
                    <h3>Nivel 1 (Lyric Video)</h3>
                    <p>Només lletra i imatges.</p>
                    <div class="cost">Cost: 5.000€</div>
                    <div class="streams">+10.000 streams potencials</div>
                </div>
                <div class="option-card" onclick="selectOption('video', 'performance', 10000, 30000)">
                    <h3>Nivel 2 (Performance)</h3>
                    <p>L'artista actuant.</p>
                    <div class="cost">Cost: 10.000€</div>
                    <div class="streams">+30.000 streams potencials</div>
                </div>
                <div class="option-card" onclick="selectOption('video', 'narrative', 20000, 70000)">
                    <h3>Nivel 3 (Narratiu)</h3>
                    <p>Un videoclip amb una història.</p>
                    <div class="cost">Cost: 20.000€</div>
                    <div class="streams">+70.000 streams potencials</div>
                </div>
            </div>
            <button class="btn" onclick="previousPhase()" style="background: #95a5a6;">⬅️ Enrere</button>
            <button class="btn" id="nextBtn3" onclick="nextPhase()" disabled>Continuar al Màrqueting 📢</button>
        </div>

        <!-- Fase 4: Màrqueting -->
        <div class="phase" id="phase4">
            <h2>📢 Fase 4: Campanya de Màrqueting</h2>
            <p>Selecciona les accions de màrqueting que vols comprar:</p>
            <div class="marketing-grid">
                <div class="option-card">
                    <label class="checkbox-option">
                        <input type="checkbox" id="teaser" onchange="updateMarketing('teaser', 2000, 5000)">
                        <div>
                            <h3>Crear un vídeo-teaser (15s)</h3>
                            <div class="cost">Cost: 2.000€</div>
                            <div class="streams">+5.000 streams</div>
                        </div>
                    </label>
                </div>
                <div class="option-card">
                    <label class="checkbox-option">
                        <input type="checkbox" id="instagram" onchange="updateMarketing('instagram', 1000, 2500)">
                        <div>
                            <h3>Crear text per Instagram</h3>
                            <div class="cost">Cost: 1.000€</div>
                            <div class="streams">+2.500 streams</div>
                        </div>
                    </label>
                </div>
                <div class="option-card">
                    <label class="checkbox-option">
                        <input type="checkbox" id="blogs" onchange="updateMarketing('blogs', 3000, 7500)">
                        <div>
                            <h3>Enviar a 10 blogs musicals</h3>
                            <div class="cost">Cost: 3.000€</div>
                            <div class="streams">+7.500 streams</div>
                        </div>
                    </label>
                </div>
                <div class="option-card">
                    <label class="checkbox-option">
                        <input type="checkbox" id="ads" onchange="updateMarketing('ads', 8000, 40000)">
                        <div>
                            <h3>Pagar publicitat Instagram/TikTok</h3>
                            <div class="cost">Cost: 8.000€</div>
                            <div class="streams">+40.000 streams</div>
                        </div>
                    </label>
                </div>
                <div class="option-card">
                    <label class="checkbox-option">
                        <input type="checkbox" id="radio" onchange="updateMarketing('radio', 6000, 30000)">
                        <div>
                            <h3>Entrevista a ràdio local</h3>
                            <div class="cost">Cost: 6.000€</div>
                            <div class="streams">+30.000 streams</div>
                        </div>
                    </label>
                </div>
                <div class="option-card">
                    <label class="checkbox-option">
                        <input type="checkbox" id="spotify" onchange="updateMarketing('spotify', 10000, 100000)">
                        <div>
                            <h3>Presentar a curadors de Spotify</h3>
                            <div class="cost">Cost: 10.000€</div>
                            <div class="streams">+100.000 streams</div>
                        </div>
                    </label>
                </div>
            </div>
            <button class="btn" onclick="previousPhase()" style="background: #95a5a6;">⬅️ Enrere</button>
            <button class="btn" onclick="nextPhase()">Continuar als Esdeveniments 🎲</button>
        </div>

        <!-- Fase 5: Esdeveniments Sessió 2 -->
        <div class="phase" id="phase5">
            <h2>🎲 Fase 5: Esdeveniments de la Sessió 2 (Producció)</h2>
            <p>Després de la producció musical, descobreix què ha passat...</p>
            <div class="card-event" id="eventCard2">
                <h3>Clica per descobrir l'esdeveniment de producció!</h3>
            </div>
            <button class="btn" onclick="drawEventCard('session2')">Treure Carta 🎴</button>
            <button class="btn" onclick="previousPhase()" style="background: #95a5a6;">⬅️ Enrere</button>
            <button class="btn" id="nextBtn5" onclick="nextPhase()" disabled style="display: none;">Continuar als Esdeveniments del Videoclip 🎬</button>
        </div>

        <!-- Fase 6: Esdeveniments Sessió 3 -->
        <div class="phase" id="phase6">
            <h2>🎲 Fase 6: Esdeveniments de la Sessió 3 (Videoclip)</h2>
            <p>Després del videoclip, veurem què ha passat...</p>
            <div class="card-event" id="eventCard3">
                <h3>Clica per descobrir l'esdeveniment del videoclip!</h3>
            </div>
            <button class="btn" onclick="drawEventCard('session3')">Treure Carta 🎴</button>
            <button class="btn" onclick="previousPhase()" style="background: #95a5a6;">⬅️ Enrere</button>
            <button class="btn" id="nextBtn6" onclick="nextPhase()" disabled style="display: none;">Continuar als Esdeveniments del Màrqueting 📢</button>
        </div>

        <!-- Fase 7: Esdeveniments Sessió 4 -->
        <div class="phase" id="phase7">
            <h2>🎲 Fase 7: Esdeveniments de la Sessió 4 (Màrqueting)</h2>
            <p>Finalment, veurem com ha anat la campanya de màrqueting...</p>
            <div class="card-event" id="eventCard4">
                <h3>Clica per descobrir l'esdeveniment del màrqueting!</h3>
            </div>
            <button class="btn" onclick="drawEventCard('session4')">Treure Carta 🎴</button>
            <button class="btn" onclick="previousPhase()" style="background: #95a5a6;">⬅️ Enrere</button>
            <button class="btn" id="nextBtn7" onclick="nextPhase()" disabled style="display: none;">Continuar al Càlcul Final 📊</button>
        </div>

        <!-- Fase 8: Càlcul Final -->
        <div class="phase" id="phase8">
            <h2>📊 Fase 6: El Balanç del Single</h2>
            <div class="summary">
                <h3>Resum de les teves inversions:</h3>
                <div id="investmentSummary"></div>
            </div>
            
            <div class="dice-container">
                <h3>🎲 Tira el Dau de la Sort!</h3>
                <p>El percentatge determinarà l'èxit final dels teus streams</p>
                <div class="dice" id="diceResult">?</div>
                <br>
                <button class="btn" onclick="rollDice()">Tirar Dau 🎲</button>
                <button class="btn" onclick="previousPhase()" style="background: #95a5a6;">⬅️ Enrere</button>
            </div>

            <div class="final-results" id="finalResults" style="display: none;">
                <h2>🏆 Resultats Finals</h2>
                <div id="finalCalculation"></div>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            budget: 50000,
            spent: 0,
            currentPhase: 1,
            selections: {
                artist: '',
                song: '',
                mood: '',
                production: null,
                video: null,
                marketing: []
            },
            streams: 0,
            eventEffects: [],
            diceResult: null
        };

        let gameHistory = [];

        const session2Events = [
            {
                name: "🎸 Col·laboració Inesperada",
                description: "Un músic de sessió famós passava per l'estudi, li ha agradat la vostra maqueta i ha gravat un solo de guitarra gratis.",
                effect: { type: 'streams', value: 20000 }
            },
            {
                name: "🎼 Patrocini Tècnic",
                description: "Una marca d'instruments us patrocina el material de l'estudi.",
                effect: { type: 'money', value: -3000 }
            },
            {
                name: "⚡ Error Tècnic",
                description: "El disc dur de l'estudi s'ha espatlat i heu de pagar un extra per a recuperar les pistes.",
                effect: { type: 'money', value: 3000 }
            },
            {
                name: "⏰ Retard del Productor",
                description: "El vostre productor/a té una altra feina urgent i el vostre projecte es retarda, perdent 'momentum'.",
                effect: { type: 'streams', value: -10000 }
            },
            {
                name: "😊 Tot Va Bé",
                description: "La sessió de producció ha anat perfectament segons el pla. No hi ha cap incident.",
                effect: { type: 'none', value: 0 }
            }
        ];

        const session3Events = [
            {
                name: "🎨 Disseny Viral",
                description: "La caràtula que heu dissenyat és tan bona que es fa viral a les xarxes abans del llançament.",
                effect: { type: 'streams', value: 25000 }
            },
            {
                name: "🏆 Premi de Disseny",
                description: "El vostre storyboard guanya un petit premi d'una escola de cinema. Us donen una ajuda per al rodatge.",
                effect: { type: 'money', value: -5000 }
            },
            {
                name: "⚡ Exigències del Director",
                description: "El director del videoclip que volíeu contractar ha pujat les seves tarifes a última hora.",
                effect: { type: 'money', value: 4000 }
            },
            {
                name: "⚖️ Problemes de Copyright",
                description: "Una de les imatges que volíeu per a la caràtula tenia drets d'autor. Heu de pagar una llicència d'urgència.",
                effect: { type: 'money', value: 2000 }
            },
            {
                name: "🌧️ Mal Temps",
                description: "El dia que havíeu de gravar el videoclip, va ploure a bots i barrals. Heu de llogar el material un dia més.",
                effect: { type: 'money', value: 2000 }
            },
            {
                name: "😊 Tot Va Bé",
                description: "El rodatge del videoclip ha anat perfectament segons el pla. No hi ha cap incident.",
                effect: { type: 'none', value: 0 }
            }
        ];

        const session4Events = [
            {
                name: "🌟 Influencer a Bord",
                description: "Un influencer famós ha descobert la vostra maqueta a TikTok i l'ha compartit. La vostra campanya es fa viral!",
                effect: { type: 'streams', value: 50000 }
            },
            {
                name: "📻 Cop de Sort a la Ràdio",
                description: "Una ràdio local important vol entrevistar el vostre artista sense cost (si no l'havíeu comprat) o rebeu +20.000 streams extra (si ja l'havíeu comprat).",
                effect: { type: 'streams', value: 20000 }
            },
            {
                name: "💰 Subvenció Cultural",
                description: "L'ajuntament us dona una petita subvenció per a promoció cultural.",
                effect: { type: 'money', value: -5000 }
            },
            {
                name: "📱 Canvi d'Algoritme",
                description: "Justament aquesta setmana, Instagram ha canviat l'algoritme i l'abast de les publicacions ha caigut en picat.",
                effect: { type: 'streams', value: -15000 }
            },
            {
                name: "💬 Mala Crítica",
                description: "Un blog musical important ha escoltat una filtració i ha publicat una crítica negativa abans del llançament.",
                effect: { type: 'streams', value: -20000 }
            },
            {
                name: "😊 Tot Va Bé",
                description: "La campanya de màrqueting ha anat perfectament segons el pla. No hi ha cap incident.",
                effect: { type: 'none', value: 0 }
            }
        ];

        function updateBudgetDisplay() {
            document.getElementById('budget').textContent = gameState.budget.toLocaleString();
            document.getElementById('totalSpent').textContent = gameState.spent.toLocaleString();
            document.getElementById('remaining').textContent = (gameState.budget - gameState.spent).toLocaleString();
        }

        function selectOption(category, type, cost, streams) {
            if (gameState.spent - (gameState.selections[category]?.cost || 0) + cost > gameState.budget) {
                alert('No tens prou pressupost per aquesta opció!');
                return;
            }

            // Remove previous selection styling
            document.querySelectorAll(`#phase${gameState.currentPhase} .option-card`).forEach(card => {
                card.classList.remove('selected');
            });

            // Add selection styling
            event.currentTarget.classList.add('selected');

            // Update spent amount
            if (gameState.selections[category]) {
                gameState.spent -= gameState.selections[category].cost;
            }
            gameState.spent += cost;

            // Save selection
            gameState.selections[category] = { type, cost, streams };
            
            updateBudgetDisplay();
            
            // Enable next button
            const nextBtn = document.getElementById(`nextBtn${gameState.currentPhase}`);
            if (nextBtn) nextBtn.disabled = false;
        }

        function updateMarketing(id, cost, streams) {
            const checkbox = document.getElementById(id);
            const existing = gameState.selections.marketing.find(item => item.id === id);
            
            if (checkbox.checked) {
                if (!existing && gameState.spent + cost > gameState.budget) {
                    alert('No tens prou pressupost per aquesta opció!');
                    checkbox.checked = false;
                    return;
                }
                if (!existing) {
                    gameState.selections.marketing.push({ id, cost, streams });
                    gameState.spent += cost;
                }
            } else {
                if (existing) {
                    gameState.selections.marketing = gameState.selections.marketing.filter(item => item.id !== id);
                    gameState.spent -= cost;
                }
            }
            
            updateBudgetDisplay();
        }

        function nextPhase() {
            if (gameState.currentPhase === 1) {
                gameState.selections.artist = document.getElementById('artistName').value || 'Artista Misteriós';
                gameState.selections.song = document.getElementById('songTitle').value || 'Cançó Sense Títol';
                gameState.selections.mood = document.getElementById('songMood').value || 'Mood indefinit';
            }

            document.getElementById(`phase${gameState.currentPhase}`).classList.remove('active');
            gameState.currentPhase++;
            document.getElementById(`phase${gameState.currentPhase}`).classList.add('active');
        }

        function previousPhase() {
            if (gameState.currentPhase <= 1) return;
            
            document.getElementById(`phase${gameState.currentPhase}`).classList.remove('active');
            gameState.currentPhase--;
            document.getElementById(`phase${gameState.currentPhase}`).classList.add('active');
        }

        function drawEventCard(session) {
            let events;
            let cardElementId;
            let nextBtnId;
            
            switch(session) {
                case 'session2':
                    events = session2Events;
                    cardElementId = 'eventCard2';
                    nextBtnId = 'nextBtn5';
                    break;
                case 'session3':
                    events = session3Events;
                    cardElementId = 'eventCard3';
                    nextBtnId = 'nextBtn6';
                    break;
                case 'session4':
                    events = session4Events;
                    cardElementId = 'eventCard4';
                    nextBtnId = 'nextBtn7';
                    break;
            }
            
            const randomEvent = events[Math.floor(Math.random() * events.length)];
            gameState.eventEffects.push(randomEvent);

            const cardElement = document.getElementById(cardElementId);
            let effectText = '';
            
            if (randomEvent.effect.type === 'streams') {
                effectText = randomEvent.effect.value > 0 ? 
                    `+${randomEvent.effect.value.toLocaleString()} streams` : 
                    `${randomEvent.effect.value.toLocaleString()} streams`;
            } else if (randomEvent.effect.type === 'money') {
                effectText = randomEvent.effect.value > 0 ? 
                    `+${randomEvent.effect.value.toLocaleString()}€ de cost extra` : 
                    `${Math.abs(randomEvent.effect.value).toLocaleString()}€ d'estalvi`;
            } else {
                effectText = 'Cap efecte - tot va segons el pla';
            }
            
            cardElement.innerHTML = `
                <h3>${randomEvent.name}</h3>
                <p>${randomEvent.description}</p>
                <div style="margin-top: 15px; font-size: 1.2em; font-weight: bold;">
                    ${effectText}
                </div>
            `;

            if (randomEvent.effect.type === 'money') {
                gameState.spent += randomEvent.effect.value;
                updateBudgetDisplay();
            }

            document.getElementById(nextBtnId).style.display = 'inline-block';
            document.getElementById(nextBtnId).disabled = false;
        }

        function rollDice() {
            const result = Math.floor(Math.random() * 10) + 1;
            gameState.diceResult = result * 10; // Convert to percentage
            
            document.getElementById('diceResult').textContent = `${result} (${gameState.diceResult}%)`;
            
            setTimeout(calculateFinalResults, 1000);
        }

        function calculateFinalResults() {
            // Calculate base streams
            let totalStreams = 0;
            if (gameState.selections.production) {
                totalStreams += gameState.selections.production.streams;
            }
            if (gameState.selections.video) {
                totalStreams += gameState.selections.video.streams;
            }
            gameState.selections.marketing.forEach(item => {
                totalStreams += item.streams;
            });

            // Apply event effects
            gameState.eventEffects.forEach(event => {
                if (event.effect.type === 'streams') {
                    totalStreams += event.effect.value;
                }
            });

            // Apply dice result
            const finalStreams = Math.floor(totalStreams * (gameState.diceResult / 100));
            const revenue = Math.floor(finalStreams / 1000) * 4; // 1000 streams = 4€
            const profit = revenue - gameState.spent;

            // Create summary
            let summary = `
                <h3>📋 Resum d'Inversions:</h3>
                <p><strong>Artista:</strong> ${gameState.selections.artist}</p>
                <p><strong>Cançó:</strong> "${gameState.selections.song}"</p>
                <p><strong>Mood:</strong> ${gameState.selections.mood}</p>
                <br>
            `;

            if (gameState.selections.production) {
                summary += `<p><strong>Producció:</strong> ${gameState.selections.production.type.toUpperCase()} - ${gameState.selections.production.cost.toLocaleString()}€</p>`;
            }
            if (gameState.selections.video) {
                summary += `<p><strong>Videoclip:</strong> ${gameState.selections.video.type} - ${gameState.selections.video.cost.toLocaleString()}€</p>`;
            }
            if (gameState.selections.marketing.length > 0) {
                summary += `<p><strong>Màrqueting:</strong></p><ul>`;
                gameState.selections.marketing.forEach(item => {
                    summary += `<li>${item.id} - ${item.cost.toLocaleString()}€</li>`;
                });
                summary += `</ul>`;
            }
            
            if (gameState.eventEffects.length > 0) {
                summary += `<p><strong>Esdeveniments:</strong></p><ul>`;
                gameState.eventEffects.forEach(event => {
                    let effectText = '';
                    if (event.effect.type === 'streams') {
                        effectText = event.effect.value > 0 ? `+${event.effect.value.toLocaleString()} streams` : `${event.effect.value.toLocaleString()} streams`;
                    } else if (event.effect.type === 'money') {
                        effectText = event.effect.value > 0 ? `+${event.effect.value.toLocaleString()}€` : `${event.effect.value.toLocaleString()}€`;
                    } else {
                        effectText = 'Cap efecte';
                    }
                    summary += `<li>${event.name} - ${effectText}</li>`;
                });
                summary += `</ul>`;
            }

            document.getElementById('investmentSummary').innerHTML = summary;

            const resultsHTML = `
                <h3>🎯 Streams Potencials Base: ${totalStreams.toLocaleString()}</h3>
                <h3>🎲 Percentatge d'Èxit: ${gameState.diceResult}%</h3>
                <h3>🎵 Streams Finals: ${finalStreams.toLocaleString()}</h3>
                <h3>💰 Ingressos: ${revenue.toLocaleString()}€</h3>
                <h3>💸 Despeses Totals: ${gameState.spent.toLocaleString()}€</h3>
                <h2 style="margin-top: 20px; ${profit >= 0 ? 'color: #2ecc71' : 'color: #e74c3c'}">
                    ${profit >= 0 ? '🎉 BENEFICI' : '💸 PÈRDUES'}: ${profit.toLocaleString()}€
                </h2>
                <p style="margin-top: 15px;">
                    ${profit >= 50000 ? '🏆 Increïble! Has triomfat completament!' :
                      profit >= 20000 ? '🎊 Excel·lent! Un gran èxit comercial!' :
                      profit >= 0 ? '👍 Bé! Has aconseguit beneficis.' :
                      profit >= -20000 ? '😐 No ha anat malament, però has perdut diners.' :
                      '😢 Ai! Aquesta vegada no ha funcionat.'}
                </p>
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="saveGameAndShowOptions()">💾 Guardar Partida</button>
                </div>
                <div style="margin-top: 15px; padding: 20px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); border-radius: 15px; color: white; box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);">
                    <h3 style="margin: 0 0 15px 0; font-size: 1.1em; display: flex; align-items: center;">
                        💡 <span style="margin-left: 10px;">Realitat de la Indústria Musical</span>
                    </h3>
                    <p style="margin: 0; line-height: 1.6; font-size: 0.95em;">
                        Els <strong>streams no generen grans beneficis directes</strong>. El seu valor real està en 
                        <strong>construir audiència</strong> que després es pot monetitzar amb gires, merchandising i patrocinios. 
                        Encara que també cal recordar que les gires tenen molts més gastos (transport, allotjament, equip tècnic, personal...).
                    </p>
                    <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; font-size: 0.9em;">
                        🎯 <strong>L'objectiu:</strong> Més streams = Més audiència = Més oportunitats futures
                    </div>
                </div>
            `;

            document.getElementById('finalCalculation').innerHTML = resultsHTML;
            document.getElementById('finalResults').style.display = 'block';
            
            // Store final results for saving
            gameState.finalStreams = finalStreams;
            gameState.revenue = revenue;
            gameState.profit = profit;
        }

        // Initialize game
        updateBudgetDisplay();

        function saveGameAndShowOptions() {
            // Save current game to history
            const gameRecord = {
                gameNumber: gameHistory.length + 1,
                artist: gameState.selections.artist,
                song: gameState.selections.song,
                mood: gameState.selections.mood,
                production: gameState.selections.production,
                video: gameState.selections.video,
                marketing: gameState.selections.marketing,
                events: gameState.eventEffects,
                spent: gameState.spent,
                finalStreams: gameState.finalStreams,
                revenue: gameState.revenue,
                profit: gameState.profit,
                diceResult: gameState.diceResult,
                date: new Date().toLocaleString('ca-ES')
            };
            
            gameHistory.push(gameRecord);
            
            // Show options
            const optionsHTML = `
                <div style="text-align: center; margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px;">
                    <h3 style="color: white; margin-bottom: 15px;">Què vols fer ara?</h3>
                    <button class="btn" onclick="newGame()" style="margin: 5px;">🎮 Nova Partida</button>
                    <button class="btn" onclick="showHistory()" style="margin: 5px;">📊 Veure Historial</button>
                </div>
            `;
            
            document.getElementById('finalResults').insertAdjacentHTML('afterend', optionsHTML);
            document.getElementById('historyBtn').disabled = false;
        }

        function newGame() {
            // Reset game state
            gameState = {
                budget: 50000,
                spent: 0,
                currentPhase: 1,
                selections: {
                    artist: '',
                    song: '',
                    mood: '',
                    production: null,
                    video: null,
                    marketing: []
                },
                streams: 0,
                eventEffects: [],
                diceResult: null
            };
            
            // Reset UI
            document.querySelectorAll('.phase').forEach(phase => phase.classList.remove('active'));
            document.getElementById('phase1').classList.add('active');
            
            // Clear all inputs
            document.getElementById('artistName').value = '';
            document.getElementById('songTitle').value = '';
            document.getElementById('songMood').value = '';
            
            // Reset all selections
            document.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
            
            // Reset buttons
            document.querySelectorAll('[id^="nextBtn"]').forEach(btn => {
                btn.disabled = true;
                btn.style.display = '';
            });
            
            // Reset event cards
            document.getElementById('eventCard2').innerHTML = '<h3>Clica per descobrir l\'esdeveniment de producció!</h3>';
            document.getElementById('eventCard3').innerHTML = '<h3>Clica per descobrir l\'esdeveniment del videoclip!</h3>';
            document.getElementById('eventCard4').innerHTML = '<h3>Clica per descobrir l\'esdeveniment del màrqueting!</h3>';
            document.getElementById('diceResult').textContent = '?';
            
            // Clear any extra elements
            const existingOptions = document.querySelector('[style*="text-align: center; margin-top: 20px; padding: 20px"]');
            if (existingOptions) existingOptions.remove();
            
            const existingHistory = document.getElementById('historyModal');
            if (existingHistory) existingHistory.remove();
            
            const finalResults = document.getElementById('finalResults');
            if (finalResults) finalResults.style.display = 'none';
            
            // Update displays
            updateBudgetDisplay();
            document.getElementById('gameNumber').textContent = gameHistory.length + 1;
        }

        function showHistory() {
            if (gameHistory.length === 0) {
                alert('No hi ha partides guardades encara!');
                return;
            }
            
            // Remove existing modal if any
            const existingModal = document.getElementById('historyModal');
            if (existingModal) existingModal.remove();
            
            // Create history modal
            const modalHTML = `
                <div id="historyModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; max-width: 90%; max-height: 90%; overflow-y: auto; border-radius: 15px; padding: 30px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="margin: 0; color: #764ba2;">📊 Historial de Partides</h2>
                            <button onclick="closeHistory()" style="background: #e74c3c; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">✕</button>
                        </div>
                        <div style="overflow-x: auto;">
                            ${generateHistoryTable()}
                        </div>
                        <div style="margin-top: 20px; text-align: center;">
                            ${generateStatistics()}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function generateHistoryTable() {
            let table = `
                <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                    <thead>
                        <tr style="background: #667eea; color: white;">
                            <th style="padding: 10px; border: 1px solid #ddd;">#</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Artista</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Cançó</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Producció</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Videoclip</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Despeses</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Streams</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Benefici/Pèrdua</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Dau</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            gameHistory.forEach(game => {
                const profitColor = game.profit >= 0 ? '#27ae60' : '#e74c3c';
                table += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${game.gameNumber}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${game.artist}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${game.song}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${game.production ? game.production.type.toUpperCase() : 'N/A'}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${game.video ? game.video.type : 'N/A'}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${game.spent.toLocaleString()}€</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${game.finalStreams.toLocaleString()}</td>
                        <td style="padding: 8px; border: 1px solid #ddd; color: ${profitColor}; font-weight: bold;">${game.profit.toLocaleString()}€</td>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${game.diceResult}%</td>
                    </tr>
                `;
            });
            
            table += '</tbody></table>';
            return table;
        }

        function generateStatistics() {
            const totalGames = gameHistory.length;
            const profits = gameHistory.map(g => g.profit);
            const bestProfit = Math.max(...profits);
            const worstLoss = Math.min(...profits);
            const averageProfit = profits.reduce((a, b) => a + b, 0) / totalGames;
            const successfulGames = gameHistory.filter(g => g.profit >= 0).length;
            const successRate = ((successfulGames / totalGames) * 100).toFixed(1);
            
            const bestGame = gameHistory.find(g => g.profit === bestProfit);
            const worstGame = gameHistory.find(g => g.profit === worstLoss);
            
            return `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h3 style="color: #764ba2; margin-bottom: 15px;">📈 Estadístiques</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; text-align: left;">
                        <div><strong>Partides jugades:</strong> ${totalGames}</div>
                        <div><strong>Taxa d'èxit:</strong> ${successRate}% (${successfulGames}/${totalGames})</div>
                        <div><strong>Millor benefici:</strong> <span style="color: #27ae60;">${bestProfit.toLocaleString()}€</span></div>
                        <div><strong>Pitjor pèrdua:</strong> <span style="color: #e74c3c;">${worstLoss.toLocaleString()}€</span></div>
                        <div><strong>Benefici mitjà:</strong> ${averageProfit.toLocaleString()}€</div>
                        <div><strong>Millor partida:</strong> "${bestGame.song}" per ${bestGame.artist}</div>
                    </div>
                </div>
            `;
        }

        function closeHistory() {
            const modal = document.getElementById('historyModal');
            if (modal) modal.remove();
        }
    </script>
</body>
</html>